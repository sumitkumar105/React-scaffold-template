# Local Development Guide

This guide walks you through setting up and running the **create-react-scaffold** project locally for development, testing, and contribution.

---

## Table of Contents

- [Prerequisites](#prerequisites)
- [Repository Structure](#repository-structure)
- [Getting Started](#getting-started)
  - [1. Clone the Repository](#1-clone-the-repository)
  - [2. Install Dependencies](#2-install-dependencies)
  - [3. Build the Configurator](#3-build-the-configurator)
  - [4. Run the CLI in Development Mode](#4-run-the-cli-in-development-mode)
- [Working with the Template](#working-with-the-template)
  - [Running the Template Standalone](#running-the-template-standalone)
  - [Environment Variables](#environment-variables)
  - [Available Template Scripts](#available-template-scripts)
- [Working with the Configurator (CLI)](#working-with-the-configurator-cli)
  - [Development Mode](#development-mode)
  - [Building from Source](#building-from-source)
  - [Available Configurator Scripts](#available-configurator-scripts)
  - [CLI Commands Reference](#cli-commands-reference)
- [Testing Locally](#testing-locally)
  - [Quick Test with npm link](#quick-test-with-npm-link)
  - [Manual End-to-End Test](#manual-end-to-end-test)
  - [Testing Individual Capabilities](#testing-individual-capabilities)
- [Project Architecture](#project-architecture)
  - [How the CLI Works](#how-the-cli-works)
  - [Configurator Source Layout](#configurator-source-layout)
  - [Template Source Layout](#template-source-layout)
- [Path Aliases](#path-aliases)
- [Code Quality](#code-quality)
  - [Linting](#linting)
  - [Formatting](#formatting)
  - [Type Checking](#type-checking)
- [Git Workflow](#git-workflow)
- [Troubleshooting](#troubleshooting)

---

## Prerequisites

Make sure you have the following installed on your machine before proceeding:

| Tool | Minimum Version | Check Command |
|------|-----------------|---------------|
| **Node.js** | >= 18.0.0 | `node --version` |
| **npm** | >= 9.0.0 | `npm --version` |
| **Git** | any recent version | `git --version` |

> **Tip:** We recommend using [nvm](https://github.com/nvm-sh/nvm) (or [nvm-windows](https://github.com/coreybutler/nvm-windows)) to manage Node.js versions.

---

## Repository Structure

This project is organized as **two independent packages** (not a monorepo with workspaces):

```
Scaffold/
├── configurator/          # The CLI tool (npm package: create-react-scaffold)
│   ├── src/               # TypeScript source for the CLI
│   ├── dist/              # Compiled output (generated by build)
│   ├── template/          # Copy of template/ (generated by build)
│   ├── package.json
│   └── tsconfig.json
│
├── template/              # The base React app template
│   ├── src/               # React application source
│   ├── index.html
│   ├── vite.config.ts
│   ├── package.json
│   └── .env.example
│
├── README.md              # End-user documentation
├── DEVELOPMENT.md         # This file
├── LICENSE
└── .gitignore
```

- **`configurator/`** is the CLI tool that users run via `npx create-react-scaffold`. It copies the template, applies selected capabilities, and installs dependencies.
- **`template/`** is the base React project that gets scaffolded. During the build step, it is copied into `configurator/template/` so it ships with the npm package.

---

## Getting Started

### 1. Clone the Repository

```bash
git clone https://github.com/your-username/create-react-scaffold.git
cd create-react-scaffold
```

Or if you already have the repository:

```bash
cd Scaffold
```

### 2. Install Dependencies

You need to install dependencies for **both** packages separately.

**Install configurator dependencies:**

```bash
cd configurator
npm install
```

**Install template dependencies (optional, only if you want to run the template standalone):**

```bash
cd ../template
npm install
```

Go back to the project root:

```bash
cd ..
```

### 3. Build the Configurator

The build step compiles TypeScript to JavaScript and copies the `template/` directory into `configurator/template/`:

```bash
cd configurator
npm run build
```

This runs two operations:
1. `tsc` - Compiles `src/*.ts` files to `dist/*.js`
2. `copy:template` - Copies `../template/` into `configurator/template/`

> **Important:** You must run the build before using `npm start` or `npm link`. The `npm run dev` command bypasses this requirement by using `tsx` for on-the-fly transpilation.

### 4. Run the CLI in Development Mode

From the `configurator/` directory:

```bash
npm run dev
```

This runs the CLI directly from TypeScript source using `tsx` (no build step needed). It will launch the interactive prompts to create a new project.

To pass arguments in dev mode:

```bash
# Create a project with specific capabilities
npm run dev -- my-test-app --tailwind --redux

# Skip prompts
npm run dev -- my-test-app -y

# Skip install
npm run dev -- my-test-app --tailwind --skip-install

# List available capabilities
npm run dev -- list

# Analyze an existing project
npm run dev -- analyze ../template
```

> **Note:** The `--` before arguments is required by npm to forward args to the underlying script.

---

## Working with the Template

### Running the Template Standalone

If you want to work on the template React app directly (e.g., to modify components, styles, or structure):

```bash
cd template
npm install       # If not already done
npm run dev
```

This starts the Vite dev server at **http://localhost:5173** with hot module replacement (HMR).

### Environment Variables

Copy the example environment file:

```bash
cp template/.env.example template/.env
```

The `.env` file accepts these variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `VITE_API_BASE_URL` | Base URL for the API client | `http://localhost:3000/api` |
| `VITE_APP_NAME` | Application display name | `MyApp` |

> All environment variables must be prefixed with `VITE_` to be exposed to the client-side code (Vite requirement).

### Available Template Scripts

Run these from the `template/` directory:

| Command | Description |
|---------|-------------|
| `npm run dev` | Start Vite dev server with HMR at `http://localhost:5173` |
| `npm run build` | Run TypeScript type-check (`tsc -b`) then build for production via Vite |
| `npm run preview` | Serve the production build locally for testing |
| `npm run lint` | Run ESLint across all `.ts` and `.tsx` files |
| `npm run lint:fix` | Run ESLint with auto-fix enabled |
| `npm run format` | Format all source files with Prettier |

---

## Working with the Configurator (CLI)

### Development Mode

Use `tsx` to run the CLI directly from TypeScript without compiling:

```bash
cd configurator
npm run dev
```

This is the fastest way to iterate on CLI changes. Every run reflects the latest source code.

### Building from Source

```bash
cd configurator
npm run build
```

Then run the compiled version:

```bash
npm start
```

### Available Configurator Scripts

Run these from the `configurator/` directory:

| Command | Description |
|---------|-------------|
| `npm run dev` | Run CLI from TypeScript source (uses `tsx`) |
| `npm run build` | Compile TypeScript + copy template to `configurator/template/` |
| `npm start` | Run the compiled CLI from `dist/index.js` |
| `npm run typecheck` | Type-check without emitting output (`tsc --noEmit`) |
| `npm run test:local` | Link globally, scaffold a test project, then clean up |
| `npm run clean` | Remove `dist/` and `template/` directories |

### CLI Commands Reference

```bash
# Create a new project (interactive)
create-react-scaffold

# Create a project with a name
create-react-scaffold my-app

# Add capabilities via flags
create-react-scaffold my-app --tailwind --redux --react-query --forms

# Specify output directory
create-react-scaffold my-app --output ~/projects

# Skip interactive prompts (base template only)
create-react-scaffold my-app -y

# Skip npm install in generated project
create-react-scaffold my-app --skip-install

# List all available capabilities
create-react-scaffold list

# Analyze an existing project
create-react-scaffold analyze ./some-react-project
```

---

## Testing Locally

### Quick Test with npm link

This simulates installing the package globally so you can run `create-react-scaffold` as a command:

```bash
# 1. Build first
cd configurator
npm run build

# 2. Link globally
npm link

# 3. Now you can use the command from anywhere
cd /tmp   # or any directory
create-react-scaffold test-app --tailwind --skip-install

# 4. Verify the generated project
cd test-app
npm install
npm run dev    # Should start at http://localhost:5173

# 5. Cleanup when done
npm unlink -g create-react-scaffold
rm -rf test-app
```

### Manual End-to-End Test

The configurator includes a built-in test script:

```bash
cd configurator
npm run test:local
```

This script will:
1. Run `npm link` to register the CLI globally
2. Scaffold a new project called `test-project` with `--skip-install`
3. Verify the generated files
4. Clean up

### Testing Individual Capabilities

Test each capability in isolation to verify it works correctly:

```bash
cd configurator

# Test Tailwind CSS capability
npm run dev -- test-tailwind --tailwind --skip-install -y

# Test Redux Toolkit capability
npm run dev -- test-redux --redux --skip-install -y

# Test React Query capability
npm run dev -- test-query --react-query --skip-install -y

# Test Forms capability
npm run dev -- test-forms --forms --skip-install -y

# Test all capabilities together
npm run dev -- test-all --tailwind --redux --react-query --forms --skip-install -y

# Verify a generated project works
cd test-all
npm install
npm run build   # Should compile without errors
npm run dev     # Should start dev server

# Cleanup
cd ..
rm -rf test-tailwind test-redux test-query test-forms test-all
```

---

## Project Architecture

### How the CLI Works

When a user runs `create-react-scaffold my-app`, the following pipeline executes:

```
1. PARSE        CLI args parsed by Commander.js
       |
2. PROMPT       Inquirer.js collects missing options interactively
       |
3. COPY         Template directory is copied to the target location
       |
4. ANALYZE      The copied project structure is analyzed (build tool, entry point, styling)
       |
5. PLAN         For each selected capability, an execution plan is generated
       |
6. VALIDATE     Plans are checked for conflicts and duplicate capabilities
       |
7. EXECUTE      Plans are executed: files created, modified, dependencies added
       |
8. INSTALL      npm install runs in the generated project (unless --skip-install)
```

### Configurator Source Layout

```
configurator/src/
├── index.ts                       # CLI entry point (Commander.js setup, prompts)
├── lib.ts                         # Core functions: generateProject, injectCapabilities, analyzeProject
├── types.ts                       # TypeScript interfaces (Capability, Plan, ProjectAnalysis, etc.)
│
├── analyzer/                      # Phase: Detect existing project structure
│   ├── index.ts                   #   Main analyze function
│   └── detectors/
│       ├── buildTool.ts           #   Detect Vite/Webpack/CRA/Next.js
│       ├── entryPoint.ts          #   Find main.tsx/App.tsx
│       └── styling.ts             #   Detect Tailwind/Styled Components/etc.
│
├── planner/                       # Phase: Generate execution plans
│   ├── index.ts                   #   Plan generation logic
│   └── prompts/
│       ├── tailwind.ts            #   Tailwind capability plan
│       ├── redux.ts               #   Redux capability plan
│       ├── reactQuery.ts          #   React Query capability plan
│       └── forms.ts               #   Forms capability plan
│
├── executor/                      # Phase: Apply plans to the project
│   ├── index.ts                   #   Plan execution engine
│   └── capabilities/
│       ├── tailwind.ts            #   Tailwind file modifications
│       ├── redux.ts               #   Redux file modifications
│       ├── reactQuery.ts          #   React Query file modifications
│       ├── forms.ts               #   Forms file modifications
│       └── providerComposer.ts    #   Injects providers into App providers
│
├── validator/                     # Phase: Pre-execution validation
│   ├── index.ts                   #   Validation orchestrator
│   └── checks/
│       ├── conflicts.ts           #   Check for conflicting capabilities
│       └── duplicates.ts          #   Check for already-installed capabilities
│
└── utils/                         # Shared utility functions
    ├── files.ts                   #   File read/write/modify operations
    ├── npm.ts                     #   npm install, add dependency
    └── git.ts                     #   Git init operations
```

### Template Source Layout

The template follows a **feature-based architecture**:

```
template/src/
├── app/                           # Application shell
│   ├── main.tsx                   #   React DOM createRoot entry
│   ├── App.tsx                    #   Root component with router outlet
│   ├── router.tsx                 #   React Router route definitions
│   └── providers/
│       └── index.tsx              #   Provider composition (BrowserRouter, ErrorBoundary)
│
├── features/                      # Domain-based feature modules
│   ├── home/
│   │   ├── components/HomePage.tsx
│   │   └── index.ts
│   ├── about/
│   │   ├── components/AboutPage.tsx
│   │   └── index.ts
│   └── auth/
│       ├── components/LoginForm.tsx
│       ├── hooks/useAuth.ts
│       ├── services/authService.ts
│       ├── types/index.ts
│       └── index.ts
│
├── shared/                        # Reusable across features
│   ├── components/                #   Button, Input, Modal, Loader, MainLayout, ErrorBoundary, etc.
│   ├── hooks/                     #   useDebounce, useLocalStorage, useToggle
│   ├── utils/                     #   cn() classname helper, formatDate
│   └── types/
│
├── services/                      # External service integrations
│   └── api/
│       ├── client.ts              #   Axios instance with request/response interceptors
│       ├── endpoints.ts           #   API route constants
│       └── types.ts               #   API response type definitions
│
├── config/                        # App configuration
│   ├── env.ts                     #   Zod-validated environment variables
│   └── constants.ts               #   APP_NAME, ROUTES
│
├── assets/                        # Static assets (images, fonts, etc.)
└── types/                         # Global TypeScript type declarations
```

---

## Path Aliases

The template uses TypeScript path aliases (configured in both `tsconfig.json` and `vite.config.ts`):

| Alias | Maps To | Example Import |
|-------|---------|----------------|
| `@/*` | `src/*` | `import { env } from '@/config/env'` |
| `@app/*` | `src/app/*` | `import { App } from '@app/App'` |
| `@features/*` | `src/features/*` | `import { useAuth } from '@features/auth'` |
| `@shared/*` | `src/shared/*` | `import { Button } from '@shared/components'` |
| `@services/*` | `src/services/*` | `import { apiClient } from '@services/api/client'` |
| `@config/*` | `src/config/*` | `import { ROUTES } from '@config/constants'` |
| `@store/*` | `src/store/*` | `import { useAppSelector } from '@store/hooks'` |
| `@assets/*` | `src/assets/*` | `import logo from '@assets/logo.svg'` |

---

## Code Quality

### Linting

The template uses **ESLint 9** with flat config (`eslint.config.js`):

```bash
cd template

# Check for lint errors
npm run lint

# Auto-fix lint errors
npm run lint:fix
```

Configured plugins:
- `typescript-eslint` - TypeScript-specific rules
- `eslint-plugin-react-hooks` - React Hooks rules of hooks
- `eslint-plugin-react-refresh` - React Fast Refresh compatibility
- `eslint-plugin-prettier` - Prettier as an ESLint rule

### Formatting

The template uses **Prettier** with these settings (`.prettierrc`):

| Setting | Value |
|---------|-------|
| Semi-colons | `false` (no semicolons) |
| Quotes | Single quotes |
| Trailing commas | `es5` |
| Tab width | 2 spaces |
| Print width | 100 characters |

```bash
cd template
npm run format
```

### Type Checking

**Configurator:**

```bash
cd configurator
npm run typecheck   # Runs tsc --noEmit
```

**Template:**

```bash
cd template
npm run build       # tsc -b runs as part of the build
```

---

## Git Workflow

The repository uses two main branches:

| Branch | Purpose |
|--------|---------|
| `main` | Production-ready releases |
| `develop` | Active development branch |

Typical workflow:

```bash
# 1. Create a feature branch from develop
git checkout develop
git pull origin develop
git checkout -b feature/my-feature

# 2. Make your changes
# ... edit files ...

# 3. Test your changes
cd configurator
npm run build
npm run dev -- test-app --tailwind --skip-install -y
rm -rf test-app

# 4. Commit and push
git add .
git commit -m "feat: description of your change"
git push origin feature/my-feature

# 5. Open a Pull Request into develop
```

---

## Troubleshooting

### "Template not found" error when running `npm run dev`

The development mode looks for the template at `../../template` relative to the source. Make sure:
- You're running the command from inside `configurator/`
- The `template/` directory exists at the repository root

### "Cannot find module" errors in the configurator

```bash
cd configurator
npm install
npm run build
```

### Generated project has TypeScript errors

Make sure you're installing dependencies in the generated project:

```bash
cd generated-project
npm install
```

### Port 5173 already in use

Another Vite instance may be running. Either stop it or Vite will automatically pick the next available port (5174, 5175, etc.).

### `npm link` doesn't create the command

On Windows, you may need to run your terminal as Administrator. On macOS/Linux, you may need to fix npm permissions:

```bash
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

### Build fails with "configurator/template not found"

The `copy:template` script runs as part of `npm run build`. Make sure the `template/` directory exists at the repository root:

```bash
ls template/package.json   # Should exist
cd configurator
npm run build
```

### Changes to template not reflected in generated projects

After modifying files in `template/`, you must rebuild the configurator:

```bash
cd configurator
npm run build    # Re-copies template/ into configurator/template/
```

Or use `npm run dev` which resolves the template from the repository root directly (no copy needed).
